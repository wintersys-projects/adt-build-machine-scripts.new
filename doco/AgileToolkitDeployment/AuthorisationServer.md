The Authorisation server is a zero trust solution which works with the Agile Deployment Toolkit.

To set up an authorisation server you have to do the following:

- Develop and baseline an application for collecting IP addresses of client machines using the agile deployment toolkit according to your liking. There's a lot of different ways you could develop this but I suggest using Joomla and Convert Forms from [Tassos](https://www.tassos.gr)

- In another (separate) user account within your cloudhost deploy your main application as normal but with "AUTHORISATION_SERVER" set to "1" in the template or when prompted. Whenever you are not deploying an authorisation server solution, "AUTHROISATION_SERVER" should be set to "0" but when this is the case you will  not be using Cloudflare for your DNS provider. 

- Require your users to authenticate to the authorisation server (and provide their IP address) before access is granted to the main application by the system. It is assumed (mandated) that you are using the naked DNS services of your cloudhost for your application servers and cloudflare DNS for your authentication server.

This is my own solution to zero trust you may want to use "Cloudflare access" as another way to protect your web property but that costs $ per user after more than 50 users and so might break the bank a bit.

There are sample repos for a (very minimal) bare bones authorisation server at: [db](https://github.com/adt-apps/authorisation-db-baseline) and [webroot](https://github.com/adt-apps/authorisation-webroot-sourcecode-baseline)

It does require users to be savvy to what is going on. Remember the main website is totally firewalled off until the user autheticates to the separate authorisation server. Once the user authenticates to the authorisation server and directly provides their current IP address to the authentication server through its GUI interface the authentication server then securely commmunicates with the main application servers which then punches holes for the particular IP addresses that the authorisation server has provided in the (UFW) firewalls of any and all of its active webservers. If the user goes directly to the main website at a later date and their laptop IP address has changed they will be timed out from the main website and they will have to know that they need to re-authenticate back and supply their new IP address to the authentication server. Using an appraoch such as this is considerably more secure (it stops bots getting at your application at all) but I don't know of a way to communicate upon a timeout because of an IP block to the user that they need to re-authenticate with the authorisation server. The system currently uses ufw to control user level access to the webproperty but the code could be extended to support the current cloudhost's native firewalling system but most native firewall systems have limits on how many ip addresses can be added. Using the native firewalling system (which isn't currently possible) has some advantages such as removing processing load from your webserver and possibly the native firewalls are more secure than ufw. 

At a periodicity suitable to you at at a limited usage time (at night), daily, weekly, monthly, remove all authroised ip addresses from the system through the authenticaion server's application (in the administration area) so that you don't get a build up of IP addresses that are allowed that shouldn't be where people have logged in (from an Internet cafe) as a one off and allowed access to that IP address through the authorisation server never to log in from there again. You can of course do this by writing a simple cron script to clean things up. If you don't clear out your list of allowed IP addresses of the authorisation server you might end up with many IP addresses that are being allowed but that are not actively being used. Obviously when you delete all allowed IP addresses, all of your users will have to reauthenticate with the authentication server the next time they want to use the main application. 

The authentication server and application server will need to have distinct DNS names if you are using the authentication server.

So, if I am building a social network application called "nuocial" I might have my authentication server as www.nuocialauth.uk and my main application or social network as community.nuocial.uk. The user will have to go to www.nuocialauth.org.uk first and provide their ip addresss (of course I am sure that the ip address of their machine could be automatically fetched by the application rather than having them enter it themselves) and then they go to community.nuocial.org.uk.
